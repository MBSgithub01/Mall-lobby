var CameraManager=pc.createScript("cameraManager");CameraManager.prototype.initialize=function(){this.controllerA=this.entity.findByName("Pointclick"),this.controllerB=this.entity.findByName("FPV")},CameraManager.prototype.update=function(){this.app.keyboard.wasReleased(pc.KEY_C)&&this.toggleController()},CameraManager.prototype.toggleController=function(){this.controllerA.enabled?(this.controllerA.enabled=!1,this.controllerB.enabled=!0):(this.controllerA.enabled=!0,this.controllerB.enabled=!1)};var VideoTexture=pc.createScript("videoTexture");VideoTexture.attributes.add("videoAsset",{title:"Video Asset",description:"MP4 video asset to play back on this video texture.",type:"asset"}),VideoTexture.attributes.add("videoUrl",{title:"Video Url",description:"URL to use if there is video asset selected",type:"string"}),VideoTexture.attributes.add("playEvent",{title:"Play Event",description:"Event that is fired as soon as the video texture is ready to play.",type:"string",default:""}),VideoTexture.prototype.initialize=function(){var e=this.app,t=document.createElement("video");t.loop=!0,t.muted=!0,t.playsInline=!0,t.crossOrigin="anonymous",t.autoplay=!0;var i=t.style;i.width="1px",i.height="1px",i.position="absolute",i.opacity="0",i.zIndex="-1000",i.pointerEvents="none",document.body.appendChild(t),this.videoTexture=new pc.Texture(e.graphicsDevice,{format:pc.PIXELFORMAT_R8_G8_B8,minFilter:pc.FILTER_LINEAR_MIPMAP_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,mipmaps:!0}),this.videoTexture.setSource(t),t.addEventListener("canplaythrough",function(i){e.fire(this.playEvent,this.videoTexture),t.play()}.bind(this)),t.src=this.videoAsset?this.videoAsset.getFileUrl():this.videoUrl,document.body.appendChild(t),t.load(),this.on("destroy",(function(){this.videoTexture.destroy(),t.remove()}),this)},VideoTexture.prototype.update=function(e){this.videoTexture.upload()};var TvScreen=pc.createScript("tvScreen");TvScreen.attributes.add("screenMaterial",{title:"Screen Material",description:"The screen material of the TV that displays the video texture.",type:"asset",assetType:"material"}),TvScreen.attributes.add("playEvent",{title:"Play Event",description:"Set the TV screen material emissive map on this event.",type:"string",default:""}),TvScreen.prototype.initialize=function(){this.app.on(this.playEvent,(function(e){var t=this.screenMaterial.resource;t.emissiveMap=e,t.update()}),this)};function example(e){const t=new pc.Application(e,{}),n={"helipad.dds":new pc.Asset("helipad.dds","cubemap",{url:"/static/assets/cubemaps/helipad.dds"},{type:pc.TEXTURETYPE_RGBM}),font:new pc.Asset("font","font",{url:"/static/assets/fonts/arial.json"})};new pc.AssetListLoader(Object.values(n),t.assets).load((()=>{t.start(),t.setCanvasFillMode(pc.FILLMODE_FILL_WINDOW),t.setCanvasResolution(pc.RESOLUTION_AUTO),t.scene.toneMapping=pc.TONEMAP_ACES,t.scene.skyboxMip=1,t.scene.skyboxIntensity=1;const e=new pc.Entity;e.addComponent("camera"),e.translate(0,0,8),e.rotate(0,0,0),t.root.addChild(e);for(let e=0;e<3;e++){const n=new pc.Entity;n.addComponent("light",{type:"directional"}),t.root.addChild(n),n.rotateLocal(60+10*e,30+90*e,0)}t.scene.setSkybox(n["helipad.dds"].resources);const createSphere=function(e,n,s){const o=new pc.StandardMaterial;o.diffuse=new pc.Color(.7,.7,.7),o.specular=new pc.Color(1,1,1),o.metalness=0,o.shininess=s/4*50+50,o.useMetalness=!0,o.blendType=pc.BLEND_NORMAL,o.opacity=e>=5?((e-5)/5+.2)*((e-5)/5+.2):(e/5+.2)*(e/5+.2),o.opacityFadesSpecular=!(e>=5),o.alphaWrite=!1,o.update();const a=new pc.Entity;a.addComponent("render",{material:o,type:"sphere"}),a.setLocalPosition(e-4.5,s-2,0),a.setLocalScale(.7,.7,.7),t.root.addChild(a)},createText=function(e,n,s,o,a,c,p){const d=new pc.Entity;d.addComponent("element",{anchor:[.5,.5,.5,.5],fontAsset:e,fontSize:.5,pivot:[.5,.5],text:n,type:pc.ELEMENTTYPE_TEXT}),d.setLocalPosition(s,o,a),d.setLocalEulerAngles(c,p,0),t.root.addChild(d)};for(let e=0;e<5;e++)for(let t=0;t<10;t++)createSphere(t,0,e);createText(n.font,"Spec Fade On",-2.5,-3,0,-0,0),createText(n.font,"Spec Fade Off",2.5,-3,0,-0,0)}))}var Camera=pc.createScript("camera");Camera.attributes.add("testEntity",{type:"entity"}),Camera.prototype.initialize=function(){this.app.mouse.on("mousedown",this.onMouseDown,this)},Camera.prototype.onMouseDown=function(t){this.setRaycast(t)},Camera.prototype.setRaycast=function(t){var e=this.entity.getPosition().clone(),a=this.entity.camera.screenToWorld(t.x,t.y,this.entity.camera.farClip),i=this.app.systems.rigidbody.raycastFirst(e,a);null!=i&&(this.testEntity.setLocalPosition(i.point),this.app.fire("Player:Move",i.point))},Camera.prototype.update=function(t){};var Chase=pc.createScript("chase");Chase.prototype.initialize=function(){this.currentPosition=new pc.Vec3(.065,.033,-1.533),this.nextPosition=new pc.Vec3(.065,.033,-1.533),this.app.on("Chase:Position",this.setChasePosition,this)},Chase.prototype.setChasePosition=function(t){this.nextPosition=t},Chase.prototype.update=function(t){this.currentPosition=this.currentPosition.lerp(this.currentPosition,this.nextPosition,.1),this.entity.setPosition(this.currentPosition)};var LookCamera=pc.createScript("lookCamera");LookCamera.attributes.add("mouseLookSensitivity",{type:"number",default:.15,title:"Mouse Look Sensitivity"}),LookCamera.attributes.add("touchLookSensitivity",{type:"number",default:.2,title:"Touch Look Sensitivity"}),LookCamera.attributes.add("zoomSensitivity",{type:"number",default:2,title:"Zoom Sensitivity"}),LookCamera.attributes.add("minZoom",{type:"number",default:20,title:"Min Zoom FOV"}),LookCamera.attributes.add("maxZoom",{type:"number",default:95,title:"Max Zoom FOV"}),LookCamera.attributes.add("fov",{type:"number",enum:[{90:90},{180:180},{360:360}],default:360,title:"Camera FOV"}),LookCamera.attributes.add("snappinessFactor",{type:"number",default:.1,title:"Snappiness Factor",description:"Lower is faster"}),LookCamera.prototype.initialize=function(){this._tempQuat1=new pc.Quat,this._tempQuat2=new pc.Quat,this._tempVec3_1=new pc.Vec3,this.setupCamera(),this.targetFov=this.entity.camera.fov,this.moved=!1,this.moving=!1,this.app.mouse.disableContextMenu(),this.app.graphicsDevice.canvas.parentNode.classList.add("gevme-pc-venue"),this.lastTouchPosition=new pc.Vec2,this.lastPinchDistance=0,this.addEventCallbacks(),this.app.on("camera:lookat",this.onLookAt,this),this.app.on("camera:teleport",this.teleportTo,this),this.on("destroy",(function(){this.removeEventCallbacks()}),this)},LookCamera.prototype.setupCamera=function(){this.initialFront=this.entity.forward.clone();var t=this.entity.getLocalRotation();this.ey=this.getYaw(t)*pc.math.RAD_TO_DEG,this.ex=this.getPitch(t,this.ey)*pc.math.RAD_TO_DEG,this.targetEx=this.ex,this.targetEy=this.ey},LookCamera.prototype.addEventCallbacks=function(){this.app.mouse&&(this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this)),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this))},LookCamera.prototype.removeEventCallbacks=function(){this.app.mouse&&(this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this)),this.app.touch&&(this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this))},LookCamera.prototype.update=function(t){var e=1;this.snappinessFactor>0&&(e=t/this.snappinessFactor),this.ex=pc.math.lerp(this.ex,this.targetEx,e),this.ey=pc.math.lerp(this.ey,this.targetEy,e),this.entity.setLocalEulerAngles(this.ex,this.ey,0),this.entity.camera.fov=pc.math.lerp(this.entity.camera.fov,this.targetFov,.05)},LookCamera.prototype.moveCamera=function(t,e,o){this.moved?(this.targetEx+=e*o*(this.entity.camera.fov/55),this.targetEx=pc.math.clamp(this.targetEx,-90,90),this.targetEy+=t*o*(this.entity.camera.fov/55),180===this.fov&&(this.targetEy=pc.math.clamp(this.targetEy,-90,90)),90===this.fov&&(this.targetEy=pc.math.clamp(this.targetEy,-45,45))):this.moved=!0},LookCamera.prototype.onMouseMove=function(t){t.event.target.parentNode.classList.contains("gevme-pc-venue")?(this.moving=!1,this.entity.camera.screenToWorld(t.x,t.y,this.entity.camera.farClip,this.targetEnd),this.app.mouse.isPressed(pc.MOUSEBUTTON_LEFT)&&(this.moving=!0,this.moveCamera(t.dx,t.dy,this.mouseLookSensitivity))):this.app.mouse._buttons[pc.MOUSEBUTTON_LEFT]=!1},LookCamera.prototype.onMouseWheel=function(t){t.event.target.parentNode.classList.contains("gevme-pc-venue")&&(this.targetFov-=t.wheel*this.zoomSensitivity,this.targetFov=pc.math.clamp(this.targetFov,this.minZoom,this.maxZoom),t.event.preventDefault())},LookCamera.prototype.onLookAt=function(t){var e=this.entity.getPosition().clone(),o=t.getPosition().clone();o.y=e.y;var i=(new pc.Vec3).copy(o);i.sub(e).normalize();var a=i.dot(this.entity.forward),s=Math.acos(a)*pc.math.RAD_TO_DEG,h=(new pc.Vec3).cross(this.entity.forward,i).normalize();s>5&&(this.targetEy=h.y>0?this.targetEy+s:this.targetEy-s)},LookCamera.prototype.teleportTo=function(t){var e=t.getPosition().clone();this.entity.setPosition(e.x,this.entity.getPosition().y,e.z)},LookCamera.prototype.onTouchStart=function(t){var e=t.touches[0];this.lastTouchPosition.set(e.x,e.y),2===t.touches.length&&(this.lastPinchDistance=this.getPinchDistance(t.touches[0],t.touches[1]))},LookCamera.prototype.onTouchMove=function(t){var e=t.touches[0];if(this.moveCamera(e.x-this.lastTouchPosition.x,e.y-this.lastTouchPosition.y,this.touchLookSensitivity),this.lastTouchPosition.set(e.x,e.y),2===t.touches.length){var o=this.getPinchDistance(t.touches[0],t.touches[1])-this.lastPinchDistance;this.targetFov-=o*this.zoomSensitivity*.01*(this.entity.camera.fov/55),this.targetFov=pc.math.clamp(this.targetFov,20,80)}},LookCamera.prototype.getYaw=function(){var t=this.entity.forward.clone();return Math.atan2(-t.x,-t.z)},LookCamera.prototype.getPitch=function(t,e){var o=this._tempQuat1,i=this._tempQuat2;i.setFromEulerAngles(0,-e,0),o.mul2(i,t);var a=this._tempVec3_1;return o.transformVector(pc.Vec3.FORWARD,a),Math.atan2(a.y,-a.z)},LookCamera.prototype.getPinchDistance=function(t,e){var o=t.x-e.x,i=t.y-e.y;return Math.sqrt(o*o+i*i)};var Player=pc.createScript("player");Player.attributes.add("speed",{type:"number",default:1}),Player.attributes.add("characterEntity",{type:"entity"}),Player.prototype.initialize=function(){this.nextPosition=new pc.Vec3(.065,.033,-1.533),this.app.on("Player:Move",this.setMovePoint,this)},Player.prototype.setMovePoint=function(t){this.entity.lookAt(t),this.nextPosition=t},Player.prototype.update=function(t){this.entity.getPosition().clone().sub(this.nextPosition).length()>1&&this.entity.translateLocal(0,0,-this.speed),this.app.fire("Chase:Position",this.entity.getPosition())};var Preloader=pc.createScript("preloader");Preloader.attributes.add("runeCards",{type:"entity",title:"Rune Cards"}),Preloader.prototype.initialize=function(){this.loadAssets()},Preloader.prototype.loadAssets=function(){for(var e=this,t=this.app.assets.findByTag("level"),s=0,r=t.length,onAssetReady=function(){(s+=1)===r&&e.onAssetsLoaded()},a=0;a<t.length;a++)t[a].resource?onAssetReady():(t[a].ready(onAssetReady),this.app.assets.load(t[a]));t.length||this.onAssetsLoaded()},Preloader.prototype.onAssetsLoaded=function(){this.runeCards.enabled=!0};function BrightnessContrastEffect(t){pc.PostEffect.call(this,t);var e=["uniform sampler2D uColorBuffer;","uniform float uBrightness;","uniform float uContrast;","","varying vec2 vUv0;","","void main() {","    gl_FragColor = texture2D( uColorBuffer, vUv0 );","    gl_FragColor.rgb += uBrightness;","","    if (uContrast > 0.0) {","        gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - uContrast) + 0.5;","    } else {","        gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + uContrast) + 0.5;","    }","}"].join("\n");this.shader=pc.createShaderFromCode(t,pc.PostEffect.quadVertexShader,e,"BrightnessContrastShader",{aPosition:pc.SEMANTIC_POSITION}),this.brightness=0,this.contrast=0}BrightnessContrastEffect.prototype=Object.create(pc.PostEffect.prototype),BrightnessContrastEffect.prototype.constructor=BrightnessContrastEffect,Object.assign(BrightnessContrastEffect.prototype,{render:function(t,e,s){var r=this.device.scope;r.resolve("uBrightness").setValue(this.brightness),r.resolve("uContrast").setValue(this.contrast),r.resolve("uColorBuffer").setValue(t.colorBuffer),this.drawQuad(e,this.shader,s)}});var BrightnessContrast=pc.createScript("brightnessContrast");BrightnessContrast.attributes.add("brightness",{type:"number",default:0,min:-1,max:1,title:"Brightness"}),BrightnessContrast.attributes.add("contrast",{type:"number",default:0,min:-1,max:1,title:"Contrast"}),BrightnessContrast.prototype.initialize=function(){this.effect=new BrightnessContrastEffect(this.app.graphicsDevice),this.effect.brightness=this.brightness,this.effect.contrast=this.contrast,this.on("attr",(function(t,e){this.effect[t]=e}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};var SAMPLE_COUNT=15;function computeGaussian(e,t){return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-e*e/(2*t*t))}function calculateBlurValues(e,t,o,s,r){e[0]=computeGaussian(0,r),t[0]=0,t[1]=0;var i,l,a=e[0];for(i=0,l=Math.floor(SAMPLE_COUNT/2);i<l;i++){var u=computeGaussian(i+1,r);e[2*i]=u,e[2*i+1]=u,a+=2*u;var h=2*i+1.5;t[4*i]=o*h,t[4*i+1]=s*h,t[4*i+2]=-o*h,t[4*i+3]=-s*h}for(i=0,l=e.length;i<l;i++)e[i]/=a}function BloomEffect(e){pc.PostEffect.call(this,e);var t={aPosition:pc.SEMANTIC_POSITION},o=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition + 1.0) * 0.5;","}"].join("\n"),s=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),r=["precision "+e.precision+" float;","","#define SAMPLE_COUNT "+SAMPLE_COUNT,"","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets[SAMPLE_COUNT];","uniform float uBlurWeights[SAMPLE_COUNT];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),i=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=new pc.Shader(e,{attributes:t,vshader:o,fshader:s}),this.blurShader=new pc.Shader(e,{attributes:t,vshader:o,fshader:r}),this.combineShader=new pc.Shader(e,{attributes:t,vshader:o,fshader:i}),this.targets=[],this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(SAMPLE_COUNT),this.sampleOffsets=new Float32Array(2*SAMPLE_COUNT)}BloomEffect.prototype=Object.create(pc.PostEffect.prototype),BloomEffect.prototype.constructor=BloomEffect,BloomEffect.prototype._destroy=function(){var e;if(this.targets)for(e=0;e<this.targets.length;e++)this.targets[e].destroyTextureBuffers(),this.targets[e].destroy();this.targets.length=0},BloomEffect.prototype._resize=function(e){var t,o=e.colorBuffer.width,s=e.colorBuffer.height;if(o!==this.width||s!==this.height)for(this.width=o,this.height=s,this._destroy(),t=0;t<2;t++){var r=new pc.Texture(this.device,{name:"Bloom Texture"+t,format:pc.PIXELFORMAT_RGBA8,width:o>>1,height:s>>1,mipmaps:!1});r.minFilter=pc.FILTER_LINEAR,r.magFilter=pc.FILTER_LINEAR,r.addressU=pc.ADDRESS_CLAMP_TO_EDGE,r.addressV=pc.ADDRESS_CLAMP_TO_EDGE,r.name="pe-bloom-"+t;var i=new pc.RenderTarget({name:"Bloom Render Target "+t,colorBuffer:r,depth:!1});this.targets.push(i)}},Object.assign(BloomEffect.prototype,{render:function(e,t,o){this._resize(e);var s=this.device,r=s.scope;r.resolve("uBloomThreshold").setValue(this.bloomThreshold),r.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.extractShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),pc.drawFullscreenQuad(s,this.targets[1],this.vertexBuffer,this.blurShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.blurShader),r.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),r.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(s,t,this.vertexBuffer,this.combineShader,o)}});var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,title:"Threshold"}),Bloom.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"}),Bloom.prototype.initialize=function(){this.effect=new BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("attr",(function(e,t){this.effect[e]=t}),this),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect),this._destroy()}))};var VideoTexture_1=pc.createScript("videoTexture_1");VideoTexture_1.attributes.add("videoAsset",{title:"Video Asset",description:"MP4 video asset to play back on this video texture.",type:"asset"}),VideoTexture_1.attributes.add("videoUrl",{title:"Video Url",description:"URL to use if there is video asset selected",type:"string"}),VideoTexture_1.attributes.add("playEvent",{title:"Play Event",description:"Event that is fired as soon as the video texture is ready to play.",type:"string",default:""}),VideoTexture_1.prototype.initialize=function(){var e=this.app,t=document.createElement("video");t.loop=!0,t.muted=!0,t.playsInline=!0,t.crossOrigin="anonymous",t.autoplay=!0;var i=t.style;i.width="1px",i.height="1px",i.position="absolute",i.opacity="0",i.zIndex="-1000",i.pointerEvents="none",document.body.appendChild(t),this.videoTexture_1=new pc.Texture(e.graphicsDevice,{format:pc.PIXELFORMAT_R8_G8_B8,minFilter:pc.FILTER_LINEAR_MIPMAP_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,mipmaps:!0}),this.videoTexture_1.setSource(t),t.addEventListener("canplaythrough",function(i){e.fire(this.playEvent,this.videoTexture_1),t.play()}.bind(this)),t.src=this.videoAsset?this.videoAsset.getFileUrl():this.videoUrl,document.body.appendChild(t),t.load(),this.on("destroy",(function(){this.videoTexture_1.destroy(),t.remove()}),this)},VideoTexture_1.prototype.update=function(e){this.videoTexture_1.upload()};var TvScreen_1=pc.createScript("tvScreen_1");TvScreen_1.attributes.add("screenMaterial",{title:"Screen Material",description:"The screen material of the TV that displays the video texture.",type:"asset",assetType:"material"}),TvScreen_1.attributes.add("playEvent",{title:"Play Event",description:"Set the TV screen material diffuse map on this event.",type:"string",default:""}),TvScreen_1.prototype.initialize=function(){this.app.on(this.playEvent,(function(e){var t=this.screenMaterial.resource;t.diffuseMap=e,t.normalMap=e,t.update()}),this)};var VideoTexture_WATER=pc.createScript("videoTexture_WATER");VideoTexture_WATER.attributes.add("videoAsset",{title:"Video Asset",description:"MP4 video asset to play back on this video texture.",type:"asset"}),VideoTexture_WATER.attributes.add("videoUrl",{title:"Video Url",description:"URL to use if there is video asset selected",type:"string"}),VideoTexture_WATER.attributes.add("playEvent",{title:"Play Event",description:"Event that is fired as soon as the video texture is ready to play.",type:"string",default:""}),VideoTexture_WATER.prototype.initialize=function(){var e=this.app,t=document.createElement("video");t.loop=!0,t.muted=!0,t.playsInline=!0,t.crossOrigin="anonymous",t.autoplay=!0;var i=t.style;i.width="1px",i.height="1px",i.position="absolute",i.opacity="0",i.zIndex="-1000",i.pointerEvents="none",document.body.appendChild(t),this.videoTexture_WATER=new pc.Texture(e.graphicsDevice,{format:pc.PIXELFORMAT_R8_G8_B8,minFilter:pc.FILTER_LINEAR_MIPMAP_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,mipmaps:!0}),this.videoTexture_WATER.setSource(t),t.addEventListener("canplaythrough",function(i){e.fire(this.playEvent,this.videoTexture_WATER),t.play()}.bind(this)),t.src=this.videoAsset?this.videoAsset.getFileUrl():this.videoUrl,document.body.appendChild(t),t.load(),this.on("destroy",(function(){this.videoTexture_WATER.destroy(),t.remove()}),this)},VideoTexture_WATER.prototype.update=function(e){this.videoTexture_WATER.upload()};var TvScreen_WATER=pc.createScript("tvScreen_WATER");TvScreen_WATER.attributes.add("screenMaterial",{title:"Screen Material",description:"The screen material of the TV that displays the video texture.",type:"asset",assetType:"material"}),TvScreen_WATER.attributes.add("playEvent",{title:"Play Event",description:"Set the TV screen material normal map on this event.",type:"string",default:""}),TvScreen_WATER.prototype.initialize=function(){this.app.on(this.playEvent,(function(e){var t=this.screenMaterial.resource;t.normalMap=e,t.update()}),this)};var FirstPersonMovement=pc.createScript("firstPersonMovement");FirstPersonMovement.attributes.add("camera",{type:"entity",description:"Optional, assign a camera entity, otherwise one is created"}),FirstPersonMovement.attributes.add("power",{type:"number",default:2500,description:"Adjusts the speed of player movement"}),FirstPersonMovement.attributes.add("lookSpeed",{type:"number",default:.25,description:"Adjusts the sensitivity of looking"}),FirstPersonMovement.prototype.initialize=function(){this.force=new pc.Vec3,this.eulers=new pc.Vec3;var e=this.app;e.mouse.on("mousemove",this._onMouseMove,this),e.mouse.off("mousedown",(function(){e.mouse.disablePointerLock()}),this),this.entity.collision||console.error("First Person Movement script needs to have a 'collision' component"),this.entity.rigidbody&&this.entity.rigidbody.type===pc.BODYTYPE_DYNAMIC||console.error("First Person Movement script needs to have a DYNAMIC 'rigidbody' component")},FirstPersonMovement.prototype.update=function(e){this.camera||this._createCamera();var t=this.force,s=this.app,o=this.camera.forward,r=this.camera.right,i=0,a=0;(s.keyboard.isPressed(pc.KEY_A)||s.keyboard.isPressed(pc.KEY_Q))&&(i-=r.x,a-=r.z),s.keyboard.isPressed(pc.KEY_D)&&(i+=r.x,a+=r.z),s.keyboard.isPressed(pc.KEY_W)&&(i+=o.x,a+=o.z),s.keyboard.isPressed(pc.KEY_S)&&(i-=o.x,a-=o.z),(s.keyboard.isPressed(pc.KEY_LEFT)||s.keyboard.isPressed(pc.KEY_Q))&&(i-=r.x,a-=r.z),s.keyboard.isPressed(pc.KEY_RIGHT)&&(i+=r.x,a+=r.z),s.keyboard.isPressed(pc.KEY_UP)&&(i+=o.x,a+=o.z),s.keyboard.isPressed(pc.KEY_DOWN)&&(i-=o.x,a-=o.z),0===i&&0===a||(t.set(i,0,a).normalize().scale(this.power),this.entity.rigidbody.applyForce(t)),this.camera.setLocalEulerAngles(this.eulers.y,this.eulers.x,0)},FirstPersonMovement.prototype._onMouseMove=function(e){(pc.Mouse.isPointerLocked()||e.buttons[0])&&(this.eulers.x-=this.lookSpeed*e.dx,this.eulers.y-=this.lookSpeed*e.dy)},FirstPersonMovement.prototype._createCamera=function(){this.camera=new pc.Entity,this.camera.setName("First Person Camera"),this.camera.addComponent("camera"),this.entity.addChild(this.camera),this.camera.translateLocal(0,.5,0)};function HueSaturationEffect(t){pc.PostEffect.call(this,t),this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform sampler2D uColorBuffer;","uniform float uHue;","uniform float uSaturation;","","varying vec2 vUv0;","","void main() {","    gl_FragColor = texture2D( uColorBuffer, vUv0 );","","    float angle = uHue * 3.14159265;","    float s = sin(angle), c = cos(angle);","    vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","    float len = length(gl_FragColor.rgb);","    gl_FragColor.rgb = vec3(","        dot(gl_FragColor.rgb, weights.xyz),","        dot(gl_FragColor.rgb, weights.zxy),","        dot(gl_FragColor.rgb, weights.yzx)","    );","","    float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","    if (uSaturation > 0.0) {","        gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - uSaturation));","    } else {","        gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-uSaturation);","    }","}"].join("\n")}),this.hue=0,this.saturation=0}HueSaturationEffect.prototype=Object.create(pc.PostEffect.prototype),HueSaturationEffect.prototype.constructor=HueSaturationEffect,Object.assign(HueSaturationEffect.prototype,{render:function(t,e,r){var a=this.device,o=a.scope;o.resolve("uHue").setValue(this.hue),o.resolve("uSaturation").setValue(this.saturation),o.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(a,e,this.vertexBuffer,this.shader,r)}});var HueSaturation=pc.createScript("hueSaturation");HueSaturation.attributes.add("hue",{type:"number",default:0,min:-1,max:1,title:"Hue"}),HueSaturation.attributes.add("saturation",{type:"number",default:0,min:-1,max:1,title:"Saturation"}),HueSaturation.prototype.initialize=function(){this.effect=new HueSaturationEffect(this.app.graphicsDevice),this.effect.hue=this.hue,this.effect.saturation=this.saturation,this.on("attr",(function(t,e){this.effect[t]=e}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};var Tree=pc.createScript("tree");Tree.attributes.add("treeSize",{type:"vec3"}),Tree.attributes.add("amplitude",{type:"number",default:1}),Tree.attributes.add("bush",{type:"boolean",default:!1}),Tree.attributes.add("shaderTransformVS",{type:"asset",assetType:"shader"}),Tree.attributes.add("shaderVertexColorPS",{type:"asset",assetType:"shader"}),Tree.attributes.add("shaderDiffuseLeavesPS",{type:"asset",assetType:"shader"}),Tree.attributes.add("shaderEmissiveLeavesPS",{type:"asset",assetType:"shader"}),Tree.prototype.initialize=function(){var e=this.shaderTransformVS.resource,t=(this.shaderVertexColorPS.resource,this.shaderDiffuseLeavesPS.resource),a=this.shaderEmissiveLeavesPS.resource;this.bush&&(e="#define BUSH\n"+e);var s=this.treeSize;if(null!=s&&0!==s.x&&0!==s.y&&0!==s.z||(s=new pc.Vec3(254.516,240.405,320.419)),this.entity.model.model)for(var r=this.entity.model.model.meshInstances,i=0;i<r.length;i++){r[i].material.chunks.transformVS=e;var d=r[i].material.opacityMap&&!this.bush;r[i].material.setParameter("isLeaves",d?1:0,4294967295),r[i].material.forceUv1=!0,r[i].material.chunks.diffuseTexPS=t,r[i].material.chunks.emissiveTexConstFloatPS=a,r[i].material.update(),pc.treeMaterial=r[i].material,r[i].setParameter("treeSize",s.data,4294967295),r[i].setParameter("windAmplitude",this.amplitude,4294967295)}},Tree.prototype.update=function(e){};var TotalTime=pc.createScript("totalTime");TotalTime.prototype.initialize=function(){this.t=0,this.shaderTime=this.app.graphicsDevice.scope.resolve("globalTime")},TotalTime.prototype.update=function(t){this.t+=1*t,this.shaderTime.setValue(this.t)},TotalTime.prototype.swap=function(t){};var DebugShaderExplosion=pc.createScript("debugShaderExplosion");DebugShaderExplosion.prototype.initialize=function(){},DebugShaderExplosion.prototype.update=function(e){if(this.app.keyboard.wasPressed(pc.KEY_6)){var a,t,i,o,r,n,s,h=this.app.scene.drawCalls,l={},p={};for(a=0;a<h.length;a++)if((t=h[a])._shader&&t._shader[1]){for((i=l[t.material.name])||(l[t.material.name]=i=[t._shader[1]],p[t.material.name]=[t]),r=i.length,n=!0,o=0;o<r;o++)if(i[o]===t._shader[1]){n=!1;break}n&&(i.push(t._shader[1]),p[t.material.name].push(t))}for(s in l)if(l.hasOwnProperty(s)&&l[s].length>1)for(console.log(l[s].length+": "+s),o=0;o<l[s].length;o++)console.log(" - "+(p[s][o]._staticLightList?p[s][o]._staticLightList.length:"No")+" lights ("+(p[s][o].node?p[s][o].node.name:"?")+")")}};var RenderDebug=pc.createScript("renderDebug");RenderDebug.prototype.initialize=function(){var e=this.app.root.findByName("Camera").camera.camera;pc.skipRenderCamera=e,pc.skipRenderAfter=0,this.enabled=!1},RenderDebug.prototype.update=function(e){};var Loader=pc.createScript("loader");function onFinishExp2(){}Loader.prototype.loadAssets=function(o,a,t){for(var e=this.app,n=0,onLoad=function(){if(++n===o.length){for(var e=0;e<a.length;e++)a[e].enabled=!0;t()}},i=0;i<o.length;i++)o[i].resource?onLoad():(o[i].once("load",onLoad),e.assets.load(o[i]))},Loader.prototype.initialize=function(){var o=this.app,a="load-exp2",t=o.assets.findByTag(a),e=o.root.findByTag(a);this.loadAssets(t,e,onFinishExp2);var n="load-phone";o.assets.findByTag(n),o.root.findByTag(n)},Loader.prototype.update=function(o){};pc.script.createLoadingScreen((function(e){var a,t;a=["body {","    background-color: #f0f4f4;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #f0f4f4;","}","","#application-splash {","    position: absolute;","    top: calc(50% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","","#application-splash img {","    width: 100%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #1d292c;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #ae986b;","}","","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(t=document.createElement("style")).type="text/css",t.styleSheet?t.styleSheet.cssText=a:t.appendChild(document.createTextNode(a)),document.head.appendChild(t),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var a=document.createElement("div");a.id="application-splash",e.appendChild(a),a.style.display="none";var t=document.createElement("img");t.src="https://playcanvas.com/api/assets/147321930/file/Marina_Bay_Sands_logo_logotype.png",a.appendChild(t),t.onload=function(){a.style.display="block"};var o=document.createElement("div");o.id="progress-bar-container",a.appendChild(o);var n=document.createElement("div");n.id="progress-bar",o.appendChild(n)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var a=document.getElementById("progress-bar");a&&(e=Math.min(1,Math.max(0,e)),a.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));